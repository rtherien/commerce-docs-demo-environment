<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test</title>
    <script type="module" src="https://static.cloud.coveo.com/atomic/v3/atomic.esm.js"></script>
    <link rel="stylesheet" href="https://static.cloud.coveo.com/atomic/v3/themes/coveo.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Debug Test Page</h1>
    <div class="debug" id="debug-log">Loading...</div>
    
    <atomic-commerce-interface
        organization-id="coveodocumentationtest"
        tracking-id="commerce-docs-demo"
        type="search"
    >
        <h2>Search Interface Loading...</h2>
        <atomic-commerce-search-box></atomic-commerce-search-box>
        <atomic-commerce-product-list>
            <atomic-product-template>
                <template>
                    <div style="border: 1px solid #ccc; padding: 10px; margin: 10px;">
                        <atomic-product-text field="ec_name"></atomic-product-text>
                        <atomic-product-price currency="CAD"></atomic-product-price>
                    </div>
                </template>
            </atomic-product-template>
        </atomic-commerce-product-list>
    </atomic-commerce-interface>

    <script>
        const debugLog = document.getElementById('debug-log');
        
        function log(message) {
            console.log(message);
            debugLog.innerHTML += '<br>' + message;
        }
        
        log('Script started...');
        
        (async () => {
            try {
                log('Waiting for atomic-commerce-interface...');
                await customElements.whenDefined('atomic-commerce-interface');
                log('atomic-commerce-interface defined!');
                
                const commerceInterface = document.querySelector('atomic-commerce-interface');
                if (!commerceInterface) {
                    log('ERROR: No commerce interface found!');
                    return;
                }
                
                log('Initializing commerce interface...');
                await commerceInterface.initialize({
                    accessToken: 'xxd749992c-d0b5-475f-95e6-671793e6c94a',
                    organizationId: 'coveodocumentationtest',
                    environment: 'prod',
                    analytics: {
                        trackingId: 'commerce-docs-demo'
                    },
                    context: {
                        language: 'en',
                        country: 'CA',
                        currency: 'CAD',
                        view: {
                            url: 'https://sports-store.com/debug'
                        }
                    }
                });
                log('Interface initialized successfully!');

                // Add event listeners
                commerceInterface.addEventListener('responseReceived', (event) => {
                    const products = event.detail?.response?.products || [];
                    log(`Response received: ${products.length} products found`);
                    products.forEach((p, i) => log(`  ${i+1}. ${p.ec_name}`));
                });

                commerceInterface.addEventListener('queryError', (event) => {
                    log('Query error: ' + JSON.stringify(event.detail));
                });

                log('Executing first request...');
                await commerceInterface.executeFirstRequest();
                log('First request completed!');
                
            } catch (error) {
                log('ERROR: ' + error.message);
                console.error('Full error:', error);
            }
        })();
    </script>
</body>
</html>